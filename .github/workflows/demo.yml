name: Generate Demo Preview

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  demo:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Generate Demo Dashboard
        uses: sidbhasin13/sbom-ui-action@main
        with:
          sbom-files: 'nonexistent-pattern-*.json'  # This will trigger sample data generation
          output-dir: 'demo-dashboard'
          title: 'SBOM UI Action - Live Demo'
          theme: 'dark'

      - name: Add demo notice and preview instructions
        run: |
          # Add a prominent demo notice to the HTML
          cat > demo-dashboard/demo-notice.html << 'EOF'
          <div style="position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(90deg, #ff6b6b, #4ecdc4); color: white; padding: 15px; text-align: center; z-index: 1000; font-family: Arial, sans-serif; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
            <strong>DEMO PREVIEW:</strong> This shows sample data for demonstration purposes. Your actual SBOM data will be safe and private when you use this action in your own repository.
          </div>
          <script>
            // Add some padding to body to account for the notice
            document.body.style.paddingTop = '60px';
          </script>
          EOF
          
          # Create a comprehensive preview guide
          cat > demo-dashboard/PREVIEW-GUIDE.md << 'EOF'
          # SBOM UI Action - Live Demo Preview
          
          ## What You're Seeing
          This is a **preview** of how your SBOM dashboard will look when you use the `sidbhasin13/sbom-ui-action` in your own repository.
          
          ## Data Safety
          - **This is SAMPLE DATA** - No real vulnerabilities or sensitive information
          - **Your actual SBOM data stays private** in your repository
          - **No data is shared** with external services
          
          ## How to Use in Your Repository
          
          ### 1. Add to Your Workflow
          ```yaml
          name: Generate SBOM Dashboard
          on: [push, workflow_dispatch]
          
          jobs:
            generate-dashboard:
              runs-on: ubuntu-latest
              steps:
                - uses: actions/checkout@v4
                
                - name: Generate SBOM UI
                  uses: sidbhasin13/sbom-ui-action@main
                  with:
                    sbom-files: '**/*.json'  # Adjust pattern for your SBOM files
                    output-dir: 'sbom-dashboard'
                    title: 'My Project SBOM Dashboard'
          ```
          
          ### 2. Deploy Options
          The action generates everything you need for deployment:
          - **Static files** ready for any hosting platform
          - **GitHub Pages workflow** (if you want to use GitHub Pages)
          - **Deployment instructions** for other platforms
          
          ### 3. Supported Platforms
          - GitHub Pages
          - Netlify
          - Vercel
          - Any static hosting service
          
          ## Features You'll Get
          - Interactive vulnerability dashboard
          - Search and filter capabilities
          - CVSS score distribution charts
          - Component and license tracking
          - Responsive design for all devices
          
          ## Need Help?
          Check the generated `DEPLOYMENT.md` file in your output directory for detailed instructions.
          EOF
          
          # Create a simple preview index
          cat > demo-dashboard/preview.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>SBOM UI Action - Preview</title>
              <style>
                  body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
                  .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                  .header { text-align: center; margin-bottom: 30px; }
                  .demo-notice { background: #e3f2fd; border: 1px solid #2196f3; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
                  .btn { display: inline-block; background: #2196f3; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; margin: 10px 5px; }
                  .btn:hover { background: #1976d2; }
                  .feature { margin: 15px 0; padding: 10px; background: #f9f9f9; border-left: 4px solid #4caf50; }
              </style>
              <script>
                  // Simple script to help with local file navigation
                  window.addEventListener('load', function() {
                      console.log('Preview page loaded');
                      console.log('Current directory:', window.location.pathname);
                      console.log('Available files should be in the same directory as this preview.html');
                  });
              </script>
          </head>
          <body>
              <div class="container">
                  <div class="header">
                      <h1>SBOM UI Action - Live Preview</h1>
                      <p>See how your SBOM dashboard will look with this interactive demo</p>
                  </div>
                  
                  <div class="demo-notice">
                      <strong>Safe Demo:</strong> This shows sample data only. Your actual SBOM data remains private in your repository.
                  </div>
                  
                  <div class="feature">
                      <h3>Interactive Dashboard</h3>
                      <p>View the full interactive dashboard with sample vulnerability data</p>
                      <a href="index.html" class="btn" target="_blank">View Dashboard</a>
                  </div>
                  
                  <div class="feature">
                      <h3>Deployment Guide</h3>
                      <p>Learn how to deploy this to your own hosting platform</p>
                      <a href="DEPLOYMENT.md" class="btn" target="_blank">View Instructions</a>
                  </div>
                  
                  <div class="feature">
                      <h3>Preview Guide</h3>
                      <p>Detailed information about features and usage</p>
                      <a href="PREVIEW-GUIDE.md" class="btn" target="_blank">Read Guide</a>
                  </div>
                  
                  <div style="text-align: center; margin-top: 30px; color: #666;">
                      <p>Ready to use in your repository? Just add the action to your workflow!</p>
                  </div>
          </div>
          </body>
          </html>
          EOF

      - name: Upload demo artifact
        uses: actions/upload-artifact@v4
        with:
          name: sbom-ui-demo
          path: 'demo-dashboard'
          retention-days: 30

      - name: Show preview info
        run: |
          echo "Demo preview generated successfully!"
          echo "Files created:"
          ls -la demo-dashboard/
          echo ""
          echo "Preview files:"
          echo "  - preview.html (main preview page)"
          echo "  - index.html (interactive dashboard)"
          echo "  - PREVIEW-GUIDE.md (usage instructions)"
          echo "  - DEPLOYMENT.md (deployment options)"
          echo ""
          echo "Users can download the artifact to see the preview!"